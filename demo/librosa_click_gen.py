import librosa
import os

wav = os.path.join('./audio/another_one_bites_the_dust.wav')

# Calculate an array of amplitudes (x) the sample rate (sr) for the input file
x, sr = librosa.load(wav)

# Calculate tempo and array of beats from input file
tempo, beats = librosa.beat.beat_track(y = x, sr = sr)

# Set parameters
click_freq = 1200
click_duration = 0.5

# Generate the clicktrack
x_beats = librosa.clicks(
            frames = beats, # the beats to place clicks
            sr = sr, # sample rate
            length = len(x), # length of the song (necessary to align clicktrack and song)
            click_freq = click_freq, # frequency of each click (in Hz)
            click_duration = click_duration # duration of each click (in seconds)
          )

# Adjust the volume. vol_adj is in decibles
vol_adj_click = -0.5
vol_adj_song = 0

x = x + vol_adj_song
x_beats = x_beats + vol_adj_click 

# Export
librosa.output.write_wav("./audio/click.wav", x + x_beats, sr = sr)


# Example usage of librosa.beat.beat_track()
demoTempo, demoBeatArray = librosa.beat.beat_track(y = demoAudio, sr = demoSampleRate)
# Outputs
demoBeatArray = [276,299,322,345,369,392,416,439,463,486,509,532,556,579,
                603,626,650,673,696,720,743,766,790,813,837,860,883,907,
                930,954,977,1000,1024,1047,1071,1094,1118,1141,1165,1188,1212,1235,
                1258,1281,1304,1328,1351,1374,1398,1421,1445,1468,1491,1515,1539,1562,
                1585,1609,1632,1656,1679,1702,1726,1749,1772,1796,1819,1842,1866,1890,
                1913,1936,1959,1983,2006,2029,2053,2076,2100,2123,2147,2170,2193,2217,
                2241,2263,2287,2311,2334,2357,2381,2404,2428,2451,2475,2498,2521,2545,
                2567,2591,2615,2637,2661,2685,2709,2732,2755,2778,2802,2825,2849,2872,
                2896,2919,2942,2966,2989,3013,3037,3060,3083,3107,3130,3153,3176,3200,
                3224,3247,3270,3293,3317,3340,3363,3387,3411,3434,3458,3481,3505,3528,
                3551,3575,3598,3621,3644,3668,3691,3715,3738,3762,3785,3807,3832,3855,
                3878,3902,3925,3948,3972,3996,4019,4042,4065,4089,4113,4135,4160,4183,
                4207,4229,4253,4276,4300,4323,4347,4370,4392,4417,4440,4464,4488,4511,
                4535,4558,4582,4604,4627,4651,4674,4698,4721,4745,4769,4792,4815,4838,
                4862,4885,4909,4932,4956,4979,5003,5026,5049,5073,5096,5120,5144,5167,
                5191,5214,5237,5260,5284,5307,5332,5355,5378,5401,5425,5448,5472,5495,
                5519,5542,5565,5589,5612,5636,5659,5683,5707,5730,5753,5776,5800,5823,
                5847,5870,5894,5918,5941,5964,5987,6011,6034,6057,6082,6105,6128,6152,
                6175,6198,6222,6245,6269,6292,6316,6339,6363,6385,6409,6433,6457,6479,
                6503,6527,6548,6573,6597,6621,6645,6668,6691,6714,6738,6761,6785,6808,
                6831,6855,6878,6902,6925,6949,6972,6996,7020,7043,7065,7089,7112,7136,
                7160,7183,7206,7230,7253,7277,7300,7324,7347,7371,7394,7418,7441,7464,
                7488,7511,7535,7558,7581,7605,7628,7651,7675,7699,7722,7745,7769,7793,
                7816,7839,7863,7886,7910,7933,7956,7979,8003,8026,8050,8073,8097,8120,
                8144,8166,8190,8213,8237,8260,8285,8308,8331,8355,8379,8402,8425,8448,
                8472,8495,8519,8542,8566,8589,8612,8636,8660,8683,8707,8730,8753,8777,
                8800,8823,8847,8871,8895,8918,8941,8964,8988,9011,9035,9058,9082,9106,
                9129,9152,9175,9198]